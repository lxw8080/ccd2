# CCD2 å•é•œåƒå®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ

## âœ… æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆå°†**æ‰€æœ‰ä¾èµ–(åŒ…æ‹¬Redis)é›†æˆåˆ°ä¸€ä¸ªDockeré•œåƒä¸­**,å®ç°çœŸæ­£çš„å•é•œåƒéƒ¨ç½²ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

- âœ… **å•é•œåƒéƒ¨ç½²**: æ‰€æœ‰æœåŠ¡(Nginx + FastAPI + React + Redis)éƒ½åœ¨ä¸€ä¸ªé•œåƒä¸­
- âœ… **é›¶å¤–éƒ¨ä¾èµ–**: é™¤PostgreSQLæ•°æ®åº“å¤–,æ— éœ€ä»»ä½•å¤–éƒ¨æœåŠ¡
- âœ… **æç®€éƒ¨ç½²**: ä¸€æ¡å‘½ä»¤å¯åŠ¨æ•´ä¸ªåº”ç”¨
- âœ… **å®Œå…¨è‡ªåŒ…å«**: é•œåƒåŒ…å«æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–
- âœ… **ç”Ÿäº§å°±ç»ª**: åŒ…å«å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨é‡å¯ã€æ•°æ®æŒä¹…åŒ–

---

## ğŸ“¦ é•œåƒä¿¡æ¯

- **é•œåƒåç§°**: `ccd2-app:all-in-one`
- **æ–‡ä»¶å**: `ccd2-app-all-in-one.tar`
- **å¤§å°**: 653.32 MB
- **åŒ…å«æœåŠ¡**:
  - Nginx (åå‘ä»£ç† + é™æ€æ–‡ä»¶æœåŠ¡)
  - FastAPI (Pythonåç«¯)
  - React (å‰ç«¯SPA)
  - Redis (ç¼“å­˜æœåŠ¡)
  - Supervisor (è¿›ç¨‹ç®¡ç†)

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### å•å®¹å™¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Container                â”‚
â”‚         (ccd2-app:all-in-one)           â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Supervisor (è¿›ç¨‹ç®¡ç†å™¨)        â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Redis   â”‚  â”‚  Nginx   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  :6379   â”‚  â”‚  :80     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                     â”‚          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  FastAPI Backend      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  :8000                â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  Port Mapping: 8080 â†’ 80                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ (External Network)
                 â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  External PostgreSQL     â”‚
      â”‚  115.190.29.10:5433      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡è¯´æ˜

æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­,ç”±Supervisorç®¡ç†:

1. **Redis** (ä¼˜å…ˆçº§10)
   - ç«¯å£: 127.0.0.1:6379 (ä»…å®¹å™¨å†…éƒ¨)
   - æ•°æ®æŒä¹…åŒ–: AOF + RDB
   - è‡ªåŠ¨å¯åŠ¨å’Œé‡å¯

2. **Nginx** (ä¼˜å…ˆçº§20)
   - ç«¯å£: 80 (æ˜ å°„åˆ°å®¿ä¸»æœº8080)
   - æœåŠ¡å‰ç«¯é™æ€æ–‡ä»¶
   - åå‘ä»£ç†APIè¯·æ±‚åˆ°FastAPI

3. **FastAPI Backend** (ä¼˜å…ˆçº§30)
   - ç«¯å£: 127.0.0.1:8000 (ä»…å®¹å™¨å†…éƒ¨)
   - è¿æ¥å†…ç½®Redis (127.0.0.1:6379)
   - è¿æ¥å¤–éƒ¨PostgreSQL

---

## ğŸš€ Windowsç«¯æ“ä½œ

### 1. é•œåƒå·²å¯¼å‡º

é•œåƒæ–‡ä»¶å·²ç”Ÿæˆ:
- `ccd2-app-all-in-one.tar` (653.32 MB)
- `ccd2-app-all-in-one.tar.sha256` (SHA256æ ¡éªŒæ–‡ä»¶)

### 2. ä¼ è¾“åˆ°æœåŠ¡å™¨

```powershell
# ä½¿ç”¨scpä¼ è¾“
scp ccd2-app-all-in-one.tar user@server-ip:/home/user/
scp ccd2-app-all-in-one.tar.sha256 user@server-ip:/home/user/

# æˆ–ä½¿ç”¨WinSCPã€FileZillaç­‰å·¥å…·
```

---

## ğŸ–¥ï¸ UbuntuæœåŠ¡å™¨ç«¯æ“ä½œ

### 1. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§

```bash
# éªŒè¯SHA256
sha256sum -c ccd2-app-all-in-one.tar.sha256
```

é¢„æœŸè¾“å‡º:
```
ccd2-app-all-in-one.tar: OK
```

### 2. åŠ è½½Dockeré•œåƒ

```bash
docker load -i ccd2-app-all-in-one.tar
```

é¢„æœŸè¾“å‡º:
```
Loaded image: ccd2-app:all-in-one
```

### 3. å¯åŠ¨å®¹å™¨

```bash
docker run -d \
  --name ccd2 \
  -p 8080:80 \
  -e DATABASE_URL="postgresql://flask_user:flask_password@115.190.29.10:5433/ccd_db_new" \
  -e SECRET_KEY="$(openssl rand -hex 32)" \
  -e LOG_LEVEL="INFO" \
  -v ccd2-uploads:/app/uploads \
  -v ccd2-logs:/app/logs \
  -v ccd2-redis-data:/var/lib/redis \
  --restart unless-stopped \
  ccd2-app:all-in-one
```

**å‚æ•°è¯´æ˜**:
- `-d`: åå°è¿è¡Œ
- `--name ccd2`: å®¹å™¨åç§°
- `-p 8080:80`: ç«¯å£æ˜ å°„
- `-e DATABASE_URL`: æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² (å¿…é¡»ä¿®æ”¹)
- `-e SECRET_KEY`: å®‰å…¨å¯†é’¥ (è‡ªåŠ¨ç”Ÿæˆéšæœºå€¼)
- `-v`: æ•°æ®å·æŒ‚è½½ (æŒä¹…åŒ–æ•°æ®)
- `--restart unless-stopped`: è‡ªåŠ¨é‡å¯ç­–ç•¥

### 4. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

```bash
docker logs -f ccd2
```

ç­‰å¾…çº¦30ç§’,ç›´åˆ°çœ‹åˆ°:
```
INFO success: redis entered RUNNING state
INFO success: nginx entered RUNNING state
INFO success: backend entered RUNNING state
```

æŒ‰ `Ctrl+C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ã€‚

### 5. éªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/api/health
```

é¢„æœŸè¾“å‡º:
```json
{"status":"healthy"}
```

### 6. è®¿é—®åº”ç”¨

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: `http://<æœåŠ¡å™¨IP>:8080`

---

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“è¿æ¥ (å¿…é¡»ä¿®æ”¹ä¸ºå®é™…å€¼)
DATABASE_URL=postgresql://flask_user:flask_password@115.190.29.10:5433/ccd_db_new

# å®‰å…¨å¯†é’¥ (å¿…é¡»ä¿®æ”¹ä¸ºéšæœºå€¼)
SECRET_KEY=$(openssl rand -hex 32)
```

### å¯é€‰çš„ç¯å¢ƒå˜é‡

```bash
# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO

# JWTç®—æ³•
ALGORITHM=HS256

# Tokenè¿‡æœŸæ—¶é—´(åˆ†é’Ÿ)
ACCESS_TOKEN_EXPIRE_MINUTES=30

# å­˜å‚¨ç±»å‹
STORAGE_TYPE=local

# ä¸Šä¼ ç›®å½•
UPLOAD_DIR=/app/uploads
```

---

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker logs -f ccd2

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker logs --tail=100 ccd2

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker exec ccd2 tail -f /var/log/supervisor/redis.log
docker exec ccd2 tail -f /var/log/supervisor/nginx.log
docker exec ccd2 tail -f /var/log/supervisor/backend.log
```

### æœåŠ¡æ§åˆ¶

```bash
# é‡å¯å®¹å™¨
docker restart ccd2

# åœæ­¢å®¹å™¨
docker stop ccd2

# å¯åŠ¨å®¹å™¨
docker start ccd2

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a | grep ccd2

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats ccd2
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥å®¹å™¨shell
docker exec -it ccd2 /bin/bash

# æ£€æŸ¥Redis
docker exec ccd2 redis-cli ping

# æ£€æŸ¥è¿›ç¨‹
docker exec ccd2 supervisorctl status
```

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½Redisæ•°æ®
docker run --rm \
  -v ccd2-redis-data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/redis-backup.tar.gz -C /data .

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
docker run --rm \
  -v ccd2-uploads:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/uploads-backup.tar.gz -C /data .

# å¤‡ä»½æ—¥å¿—
docker run --rm \
  -v ccd2-logs:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/logs-backup.tar.gz -C /data .
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker logs ccd2

# æŸ¥çœ‹Supervisoræ—¥å¿—
docker exec ccd2 cat /var/log/supervisor/supervisord.log
```

### é—®é¢˜ 2: åç«¯æœåŠ¡ä¸æ–­é‡å¯

```bash
# æŸ¥çœ‹åç«¯é”™è¯¯æ—¥å¿—
docker exec ccd2 tail -n 100 /var/log/supervisor/backend_err.log

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec ccd2 pg_isready -h 115.190.29.10 -p 5433

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec ccd2 env | grep DATABASE_URL
```

### é—®é¢˜ 3: Redisè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥RedisçŠ¶æ€
docker exec ccd2 supervisorctl status redis

# æµ‹è¯•Redisè¿æ¥
docker exec ccd2 redis-cli ping

# æŸ¥çœ‹Redisæ—¥å¿—
docker exec ccd2 tail -f /var/log/redis/redis-server.log
```

### é—®é¢˜ 4: æ— æ³•è®¿é—®åº”ç”¨

```bash
# æ£€æŸ¥ç«¯å£æ˜ å°„
docker port ccd2

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo ufw allow 8080/tcp

# æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:8080/api/health

# æŸ¥çœ‹Nginxæ—¥å¿—
docker exec ccd2 tail -f /var/log/nginx/access.log
docker exec ccd2 tail -f /var/log/nginx/error.log
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### âœ… æœ¬æœºæµ‹è¯• (Windows Docker Desktop)

- âœ… é•œåƒæ„å»ºæˆåŠŸ (653.32 MB)
- âœ… å®¹å™¨å¯åŠ¨æˆåŠŸ
- âœ… RedisæœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… NginxæœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… å¥åº·æ£€æŸ¥é€šè¿‡: `/api/health` è¿”å› `{"status":"healthy"}`
- âœ… å‰ç«¯é¡µé¢æ­£å¸¸è®¿é—®
- âœ… æ‰€æœ‰æœåŠ¡ç¨³å®šè¿è¡Œ

### æœåŠ¡ä¿¡æ¯

- **åº”ç”¨åœ°å€**: http://localhost:8080
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/api/health
- **å®¹å™¨åç§°**: ccd2-all-in-one
- **é•œåƒæ ‡ç­¾**: ccd2-app:all-in-one

---

## ğŸ“ é‡è¦è¯´æ˜

### 1. æ•°æ®åº“é…ç½®

- âœ… ä½¿ç”¨å¤–éƒ¨PostgreSQLæ•°æ®åº“ (115.190.29.10:5433)
- âœ… ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—®è¯¥æ•°æ®åº“
- âœ… æ•°æ®åº“ä¸åœ¨å®¹å™¨ä¸­,ç‹¬ç«‹ç®¡ç†

### 2. Redisé…ç½®

- âœ… Redisåœ¨å®¹å™¨å†…éƒ¨è¿è¡Œ (127.0.0.1:6379)
- âœ… æ•°æ®æŒä¹…åŒ–åˆ°Dockerå· `ccd2-redis-data`
- âœ… ä»…å®¹å™¨å†…éƒ¨è®¿é—®,ä¸å¯¹å¤–æš´éœ²
- âœ… ä½¿ç”¨AOFå’ŒRDBåŒé‡æŒä¹…åŒ–

### 3. æ•°æ®æŒä¹…åŒ–

ä»¥ä¸‹æ•°æ®ä¼šæŒä¹…åŒ–åˆ°Dockerå·:
- `ccd2-redis-data`: Redisæ•°æ®
- `ccd2-uploads`: åº”ç”¨ä¸Šä¼ çš„æ–‡ä»¶
- `ccd2-logs`: åº”ç”¨æ—¥å¿—

### 4. å®‰å…¨å»ºè®®

- âœ… å¿…é¡»ä¿®æ”¹é»˜è®¤çš„ `SECRET_KEY`
- âœ… ä½¿ç”¨å¼ºå¯†ç 
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… å®šæœŸå¤‡ä»½æ•°æ®å·
- âœ… å®šæœŸæ›´æ–°é•œåƒ

---

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

### å•é•œåƒæ–¹æ¡ˆ vs å¤šé•œåƒæ–¹æ¡ˆ

| ç‰¹æ€§ | å•é•œåƒæ–¹æ¡ˆ | å¤šé•œåƒæ–¹æ¡ˆ (Docker Compose) |
|------|-----------|---------------------------|
| é•œåƒæ•°é‡ | 1ä¸ª | 2ä¸ª (app + redis) |
| æ–‡ä»¶å¤§å° | 653 MB | 686 MB (645 + 40) |
| éƒ¨ç½²å¤æ‚åº¦ | âœ… æç®€ (ä¸€æ¡å‘½ä»¤) | ä¸­ç­‰ (éœ€è¦Docker Compose) |
| ç½‘ç»œé…ç½® | âœ… æ— éœ€é…ç½® | éœ€è¦é…ç½®ç½‘ç»œ |
| æœåŠ¡ç®¡ç† | Dockerå‘½ä»¤ | Docker Composeå‘½ä»¤ |
| èµ„æºéš”ç¦» | ä½ (åŒä¸€å®¹å™¨) | é«˜ (ç‹¬ç«‹å®¹å™¨) |
| æ‰©å±•æ€§ | ä½ | âœ… é«˜ (å¯ç‹¬ç«‹æ‰©å±•Redis) |
| é€‚ç”¨åœºæ™¯ | âœ… å°å‹éƒ¨ç½² | å¤§å‹/ç”Ÿäº§ç¯å¢ƒ |

### æ¨èä½¿ç”¨åœºæ™¯

**å•é•œåƒæ–¹æ¡ˆé€‚åˆ**:
- âœ… å°å‹é¡¹ç›®æˆ–æµ‹è¯•ç¯å¢ƒ
- âœ… ç®€å•å¿«é€Ÿéƒ¨ç½²
- âœ… èµ„æºæœ‰é™çš„æœåŠ¡å™¨
- âœ… ä¸éœ€è¦ç‹¬ç«‹æ‰©å±•Redis

**å¤šé•œåƒæ–¹æ¡ˆé€‚åˆ**:
- âœ… ç”Ÿäº§ç¯å¢ƒ
- âœ… éœ€è¦ç‹¬ç«‹æ‰©å±•æœåŠ¡
- âœ… éœ€è¦æ›´å¥½çš„èµ„æºéš”ç¦»
- âœ… éœ€è¦ç‹¬ç«‹ç®¡ç†Redis

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è¯Šæ–­ä¿¡æ¯æ”¶é›†

```bash
# æ”¶é›†è¯Šæ–­ä¿¡æ¯
docker ps -a | grep ccd2 > status.txt
docker logs ccd2 > logs.txt
docker exec ccd2 supervisorctl status > supervisor_status.txt
docker exec ccd2 cat /var/log/supervisor/backend_err.log > backend_err.txt
```

---

## ğŸ‰ æ€»ç»“

### éƒ¨ç½²æµç¨‹

1. âœ… Windowsç«¯å¯¼å‡ºé•œåƒ (653.32 MB)
2. âœ… ä¼ è¾“åˆ°UbuntuæœåŠ¡å™¨
3. âœ… åŠ è½½é•œåƒ
4. âœ… ä¸€æ¡å‘½ä»¤å¯åŠ¨å®¹å™¨
5. âœ… è®¿é—®åº”ç”¨

### å…³é”®ä¼˜åŠ¿

- **æç®€éƒ¨ç½²**: ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰é…ç½®
- **é›¶å¤–éƒ¨ä¾èµ–**: é™¤æ•°æ®åº“å¤–æ— éœ€å…¶ä»–æœåŠ¡
- **å®Œå…¨è‡ªåŒ…å«**: æ‰€æœ‰ä¾èµ–éƒ½åœ¨é•œåƒä¸­
- **ç”Ÿäº§å°±ç»ª**: åŒ…å«æ‰€æœ‰å¿…è¦çš„ç”Ÿäº§ç‰¹æ€§

---

**éƒ¨ç½²æ–¹æ¡ˆç‰ˆæœ¬**: 3.0 (å•é•œåƒç‰ˆ)  
**åˆ›å»ºæ—¶é—´**: 2025-10-18  
**çŠ¶æ€**: âœ… å·²æµ‹è¯•é€šè¿‡  
**é•œåƒå¤§å°**: 653.32 MB  
**é€‚ç”¨ç¯å¢ƒ**: Ubuntu Server + Docker

